
<template>
  <div id="center-news">
    <div id="hero">
      <h1>전국 복지관 최신 소식</h1>
      <h3>다양한 복지관 소식과 정보를 한눈에 확인하세요</h3>
    </div>

    <div class="subject">주목할만한 소식</div>

    <div id="news-cards">
      <a href="#" class="news-card">
        <div class="img-wrap">
          <img src="" alt="">
        </div>
        <div class="news-content">
          <div class="news-content-top">
            <span class="news-content-org">서울구립장애인종합복지관</span>
            <h3>2025년 장애인 일자리 지원사업 참여자 모집 안내</h3>
          </div>
          <div class="news-content-bottom">
            <span>2025. 5. 10.</span>
            <div class="arrow-box">
              <svg width="11" height="10" viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.3818 7.8682C2.55754 8.04393 2.84246 8.04393 3.0182 7.8682L7.35 3.5364V6.95C7.35 7.19853 7.55147 7.4 7.8 7.4C8.04853 7.4 8.25 7.19853 8.25 6.95V2.45C8.25 2.20147 8.04853 2 7.8 2H3.3C3.05147 2 2.85 2.20147 2.85 2.45C2.85 2.69853 3.05147 2.9 3.3 2.9H6.7136L2.3818 7.2318C2.20607 7.40754 2.20607 7.69246 2.3818 7.8682Z" fill="#2A2E43"/>
              </svg>
            </div>
          </div>
        </div>
      </a>
      <a href="#" class="news-card">
        <div class="img-wrap">
          <img src="" alt="">
        </div>
        <div class="news-content">
          <div class="news-content-top">
            <span class="news-content-org">서울구립장애인종합복지관</span>
            <h3>2025년 장애인 일자리 지원사업 참여자 모집 안내</h3>
          </div>
          <div class="news-content-bottom">
            <span>2025. 5. 10.</span>
            <div class="arrow-box">
              <svg width="11" height="10" viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.3818 7.8682C2.55754 8.04393 2.84246 8.04393 3.0182 7.8682L7.35 3.5364V6.95C7.35 7.19853 7.55147 7.4 7.8 7.4C8.04853 7.4 8.25 7.19853 8.25 6.95V2.45C8.25 2.20147 8.04853 2 7.8 2H3.3C3.05147 2 2.85 2.20147 2.85 2.45C2.85 2.69853 3.05147 2.9 3.3 2.9H6.7136L2.3818 7.2318C2.20607 7.40754 2.20607 7.69246 2.3818 7.8682Z" fill="#2A2E43"/>
              </svg>
            </div>
          </div>
        </div>
      </a>
      <a href="#" class="news-card">
        <div class="img-wrap">
          <img src="" alt="">
        </div>
        <div class="news-content">
          <div class="news-content-top">
            <span class="news-content-org">서울구립장애인종합복지관</span>
            <h3>2025년 장애인 일자리 지원사업 참여자 모집 안내</h3>
          </div>
          <div class="news-content-bottom">
            <span>2025. 5. 10.</span>
            <div class="arrow-box">
              <svg width="11" height="10" viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.3818 7.8682C2.55754 8.04393 2.84246 8.04393 3.0182 7.8682L7.35 3.5364V6.95C7.35 7.19853 7.55147 7.4 7.8 7.4C8.04853 7.4 8.25 7.19853 8.25 6.95V2.45C8.25 2.20147 8.04853 2 7.8 2H3.3C3.05147 2 2.85 2.20147 2.85 2.45C2.85 2.69853 3.05147 2.9 3.3 2.9H6.7136L2.3818 7.2318C2.20607 7.40754 2.20607 7.69246 2.3818 7.8682Z" fill="#2A2E43"/>
              </svg>
            </div>
          </div>
        </div>
      </a>
      <a href="#" class="news-card">
        <div class="img-wrap">
          <img src="" alt="">
        </div>
        <div class="news-content">
          <div class="news-content-top">
            <span class="news-content-org">서울구립장애인종합복지관</span>
            <h3>2025년 장애인 일자리 지원사업 참여자 모집 안내</h3>
          </div>
          <div class="news-content-bottom">
            <span>2025. 5. 10.</span>
            <div class="arrow-box">
              <svg width="11" height="10" viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.3818 7.8682C2.55754 8.04393 2.84246 8.04393 3.0182 7.8682L7.35 3.5364V6.95C7.35 7.19853 7.55147 7.4 7.8 7.4C8.04853 7.4 8.25 7.19853 8.25 6.95V2.45C8.25 2.20147 8.04853 2 7.8 2H3.3C3.05147 2 2.85 2.20147 2.85 2.45C2.85 2.69853 3.05147 2.9 3.3 2.9H6.7136L2.3818 7.2318C2.20607 7.40754 2.20607 7.69246 2.3818 7.8682Z" fill="#2A2E43"/>
              </svg>
            </div>
          </div>
        </div>
      </a>
    </div>

    <RecruitSearchComponent @update-data="handleSearch" />

    <div class="tabs">
      <button class="tab"
              :class="{'active' : tab == value}"
              v-for="(key, value) in tabList" :key="key"
              @click="changeTab(value)"
      >{{key}}</button>
    </div>

    <NewsPaginationComponent
        ref="paginationRef"
        :fetch-function="fetchNews"
        :url-path="'/news'"
        :initial-params="initialSearchParams"
    >

      <template #table-result-slot="{ items }">
        <a v-if="!items || items.length <= 0" class="none">검색 결과가 없습니다.</a>
        <a :href="news.link"
            v-else
            v-for="news in items"
            :key="news.newsId"
            class="result"
           target="_blank"
        >
          <span class="tit">{{ news.title }}</span>
          <div class="org">
            <span class="org-name">{{ news.organization.name }}</span>
            <div class="org-region">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8.00016 7.66665C7.55814 7.66665 7.13421 7.49105 6.82165 7.17849C6.50909 6.86593 6.3335 6.44201 6.3335 5.99998C6.3335 5.55795 6.50909 5.13403 6.82165 4.82147C7.13421 4.50891 7.55814 4.33331 8.00016 4.33331C8.44219 4.33331 8.86611 4.50891 9.17867 4.82147C9.49123 5.13403 9.66683 5.55795 9.66683 5.99998C9.66683 6.21885 9.62372 6.43558 9.53996 6.63779C9.4562 6.83999 9.33344 7.02373 9.17867 7.17849C9.02391 7.33325 8.84018 7.45602 8.63797 7.53978C8.43576 7.62354 8.21903 7.66665 8.00016 7.66665ZM8.00016 1.33331C6.76249 1.33331 5.5755 1.82498 4.70033 2.70015C3.82516 3.57532 3.3335 4.7623 3.3335 5.99998C3.3335 9.49998 8.00016 14.6666 8.00016 14.6666C8.00016 14.6666 12.6668 9.49998 12.6668 5.99998C12.6668 4.7623 12.1752 3.57532 11.3 2.70015C10.4248 1.82498 9.23784 1.33331 8.00016 1.33331Z" fill="#777984"/>
              </svg>
              <span class="org-region-name">{{news.organization.region}}</span>
            </div>
          </div>
          <span class="type">{{tabList[news.type]}}</span>
          <span class="createAt">{{ news.getCreateAt() }}</span>
        </a>
      </template>

    </NewsPaginationComponent>

  </div>
</template>

<script setup lang="ts">
import RecruitSearchComponent from "@/components/RecruitSearchComponent.vue";
import {ref} from "vue";
import NewsPaginationComponent from "@/components/NewsPaginationComponent.vue";
import {Pageable} from "@/domain/Pageable";
import {ApiServer} from "@/api/ApiServer";
import {News} from "@/domain/News";
import { newsApi } from "@/api/ApiClient";

document.title = '복지관소식 | WithIns'
const tabList = {
  'ALL' : '전체 소식',
  'NOTICE' : '공지사항',
  'WELFARE' : '복지관소식',
  'RECRUIT' : '채용',
  'EVENT' : '행사/프로그램'
};

const word = ref('');
const region = ref('ALL');
const tab = ref('ALL');

const changeTab = (tabValue : string) => {
  if (tab.value == tabValue) return;

  tab.value = tabValue;
  updateCondition({
    type: tab.value
  });
}

const updateCondition = (data : any ) : any => {
    word.value = data.word;
    region.value = data.region;
    tab.value = data.type;

  const updatedParams = {
    word : word.value,
    region : region.value,
    type : tab.value
  };

  paginationRef.value.updateSearchParams(updatedParams);
}
const paginationRef = ref<InstanceType<typeof NewsPaginationComponent> | null>(null);

// 초기 검색 파라미터
const initialSearchParams = {
  word: word.value,
  region: region.value,
  type: tab.value,
};

// 검색 함수 정의 (페이지네이션 컴포넌트에 전달)
const fetchNews = async (page: number, params: any): Promise<Pageable<News>> => {
  // API 호출 준비
  const apiParams = {
    page: page,  // 페이지 인덱스 (0부터 시작)
    size: 10,
    region: params.region || 'ALL',
    word: params.word || '',
    type: params.type || 'ALL',
  };

  // API 호출
  const json: any = await newsApi.news(apiParams);
  // const json: any = await ApiServer.fetchGet('/news', apiParams);
  const pageable = new Pageable<News>(json);
  let news : Array<News> = json.content.map((value:any) => new News(value));
  pageable.setContent(news)
  return pageable;
};

// 검색 이벤트 핸들러
const handleSearch = (searchData: any) => {
  if (paginationRef.value) {
    // 검색 파라미터 형식 변환
    const params = {
      word: searchData.word || '',
      region: searchData.region || 'ALL',
    };
    updateCondition(params);
  }
};
</script>

<style scoped>
/* Hero */
#hero {
  padding: 80px 0;
  text-align: center;
}
#hero h1 {
  font-size: 40px;
  font-weight: 700;
  color: var(--f1);
  margin-bottom: 12px;
}
#hero h3 {
  font-size: 21px;
  font-weight: 300;
  color: var(--f3);
}

.subject {
  font-size: 21px;
  margin-bottom: 32px;
  font-weight: 600;
  position: relative;
}
.subject::after {
  content: '';
  position: absolute;
  height: 2px;
  width: 50px;
  border-radius: 2px;
  background: var(--main-color-gradient);
  top: 140%;
  left: 0;
  z-index: 2;
}

/* News Card */

#news-cards {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 25px;
  margin-bottom: 100px;
}

.news-card {
  display: flex;
  flex-direction: column;
  min-height: 300px;
  border-radius: 16px;
  overflow: hidden;
  border: 1px #eee solid;
  box-shadow: 10px 10px 30px rgba(0,0,0,0.06);
  transition: transform 0.2s ease-in-out;
}
.news-card:hover {
  transform: translateY(-3px);
}
.img-wrap {
  width: 100%;
  height: 150px;
  background: linear-gradient(0deg, rgba(0,0,0,0.3) 0%, #F0F0F0 100%);
}

.news-content {
  flex: 1;
  padding: 15px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.news-content-org {
  color: var(--main-color-1);
  font-size: 14px;
  margin-bottom: 4px;
  display: block;
}
.news-content-top h3 {
  font-size: 16px;
  font-weight: 600;
}
.news-content-bottom {
  padding-top: 15px;
  border-top: 1px #F0F0F0 solid;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.news-content-bottom span {
  font-size: 13px;
}
.news-content-bottom .arrow-box {
  width: 20px;
  height: 20px;
  border-radius: 4px;
  background-color: #F7F7FB;
  display: flex;
  align-items: center;
  justify-content: center;
}


/* Tabs */
.tabs {
  display: flex;
  gap: 2px;
  margin-top: 50px;
  position: relative;
}

.tabs::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 1px;
  background-color: #eee;
  z-index: 1;
}

.tab {
  padding: 12px 24px;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  font-size: 15px;
  color: var(--f3);
  transition: all 0.2s ease;
  position: relative;
  z-index: 2;
  border-radius: 6px 6px 0 0;

  white-space: nowrap;
}

.tab:hover {
  color: var(--main-color-1);
  background-color: rgba(0, 113, 227, 0.03);
}

.tab.active {
  color: var(--main-color-1);
  border-bottom: 2px solid var(--main-color-1);
  font-weight: 600;
  background-color: #F4F9FF;
}

.tab.active::before {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--main-color-gradient);
  border-radius: 2px;
}

/* Pagination */

:deep(.searchResult > a:not(.none)),
:deep(.searchResult > button:not(.none)) {
  grid-template-columns: 40% 30% 20% 10%;
}
.searchResult > a, .searchResult > button {
  display: grid;
  align-items: center;
  justify-items: center;
  height: 80px;
  text-decoration: none;
  width: 100%;
}
.searchResult > a {
  border-bottom: 1px #DCDCDC solid;
}
.searchResult > a:last-child {
  border-bottom: 1px var(--f1) solid;
}
.searchResult > a:hover {
  background-color: var(--main-color-1-hover);
  border-radius: 5px;
}
.searchResult > a > li {
  display: flex;
  align-items: center;
  justify-content: center;
}

.tit {
  font-size: 16px;
  font-weight: 500;
  color: var(--f1);
  display: flex;
  width: 100%;
  align-items: center;
  justify-content: flex-start; /* 왼쪽 정렬 */
  padding-left: 15px; /* 원하는 경우 왼쪽 패딩 추가 */
}
.org {
  text-align: center;
}
.org-name {
  font-size: 15px;
  color: var(--f1);
  font-weight: 400;
}
.org-region {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-top: 6px;
}
.org-region-name {
  font-size: 14px;
  color: var(--f3);
  font-weight: 400;
}
.type {
  font-size: 14px;
  color: var(--f2);
}
.createAt {
  font-size: 14px;
  color: var(--f3);
  font-weight: 400;
}

@media (max-width: 1000px) {

  #news-cards {
    grid-template-columns: repeat(2, 1fr);
  }

}

@media (max-width: 900px) {

  :deep(.searchResult > a:not(.none)),
  :deep(.searchResult > button:not(.none)) {
    grid-template-columns: 60% 30% 10%;
  }

  .result .type {
    display: none;
  }
}

@media (max-width: 768px) {

  :deep(.searchResult > a:not(.none)),
  :deep(.searchResult > button:not(.none)) {
    grid-template-columns: initial;
    grid-template-rows: auto auto;
  }
  .searchResult > a {
    height: initial;
    min-height: 80px;
    align-items: center;
    justify-content: start;
    .tit {
      grid-column: 1 / 4;
      padding-top: 10px;
      padding-bottom: 5px;
    }
    .org {
      padding-left: 15px;
      padding-right: 10px;
      padding-bottom: 10px;

      .org-name {
        color: var(--f3);
        white-space: nowrap;
      }

      .org-region {
        display: none;
      }
    }
    .createAt {
      padding-bottom: 10px;
    }
  }
}

@media (max-width: 730px) {

  .tabs {
    overflow-x: auto; /* 가로 스크롤 추가 */
    flex-wrap: nowrap; /* 탭이 줄바꿈되지 않도록 설정 */
    scrollbar-width: none; /* Firefox에서 스크롤바 숨기기 */
    -webkit-overflow-scrolling: touch; /* 모바일에서 부드러운 스크롤 지원 */
  }

  /* Webkit 브라우저(Chrome, Safari 등)에서 스크롤바 숨기기 */
  .tabs::-webkit-scrollbar {
    display: none;
  }
}
</style>