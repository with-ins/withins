<template>
  <header>
    <div id="h-left">
      <div id="logo">
        <RouterLink to="/">
          <svg width="120" height="35" viewBox="0 0 120 35" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18.374 19.564L16.58 25.7C16.19 27.052 15.488 27.676 14.136 27.676C12.784 27.676 11.978 27.052 11.562 25.7L9.04 17.276C8.676 16.054 9.274 15.04 10.47 14.806C11.666 14.572 12.472 15.196 12.758 16.444L14.11 22.736H14.162L15.956 16.886C16.372 15.508 17.022 14.754 18.4 14.754C19.778 14.754 20.428 15.508 20.844 16.886L22.638 22.736H22.69L24.042 16.444C24.328 15.196 25.134 14.572 26.33 14.806C27.526 15.04 28.124 16.054 27.76 17.276L25.238 25.7C24.848 26.974 24.016 27.676 22.664 27.676C21.312 27.676 20.61 27.052 20.22 25.7L18.426 19.564H18.374ZM32.3309 25.7V16.548C32.3309 15.326 33.1109 14.546 34.3329 14.546C35.5549 14.546 36.3089 15.326 36.3089 16.548V25.7C36.3089 26.922 35.5549 27.676 34.3329 27.676C33.1109 27.676 32.3309 26.922 32.3309 25.7ZM36.6209 9.892C36.6209 11.166 35.6069 12.18 34.3329 12.18C33.0589 12.18 32.0449 11.166 32.0449 9.892C32.0449 8.618 33.0589 7.604 34.3329 7.604C35.6069 7.604 36.6209 8.618 36.6209 9.892ZM47.8696 27.91C44.8276 27.91 43.2676 26.142 43.2676 23.1V18.186H42.2796C41.2396 18.186 40.5376 17.588 40.5376 16.548C40.5376 15.508 41.2396 14.91 42.2796 14.91H43.2676V11.53C43.2676 10.308 44.0216 9.476 45.2436 9.476C46.4656 9.476 47.2196 10.308 47.2196 11.53V14.91H49.2996C50.3656 14.91 51.0416 15.508 51.0416 16.548C51.0416 17.588 50.3656 18.186 49.2996 18.186H47.2196V23.074C47.2196 24.062 47.4536 24.764 48.3116 24.764C48.6496 24.764 48.9616 24.686 49.2736 24.66C50.1316 24.504 50.9636 24.79 51.1716 25.622C51.3796 26.48 51.0156 27.26 50.0276 27.598C49.3516 27.806 48.7016 27.91 47.8696 27.91ZM55.1545 25.7V9.866C55.1545 8.644 55.9085 7.864 57.1305 7.864C58.3525 7.864 59.0805 8.644 59.0805 9.866V16.236C59.7305 15.196 61.2385 14.546 62.5905 14.546C65.4505 14.546 67.3485 16.626 67.3485 19.512V25.7C67.3485 26.922 66.5945 27.676 65.3725 27.676C64.1505 27.676 63.4225 26.922 63.4225 25.7V19.85C63.4225 18.68 62.5125 17.744 61.2385 17.744C60.0425 17.744 59.0805 18.602 59.0805 19.824V25.7C59.0805 26.922 58.3525 27.676 57.1305 27.676C55.9085 27.676 55.1545 26.922 55.1545 25.7Z" fill="#0071E3"/>
            <path d="M72.6689 25.492V10.282C72.6689 8.982 73.5529 8.098 74.8529 8.098C76.1529 8.098 77.0629 8.982 77.0629 10.282V25.492C77.0629 26.792 76.1529 27.676 74.8529 27.676C73.5529 27.676 72.6689 26.792 72.6689 25.492ZM82.3834 25.7V16.756C82.3834 15.534 83.0854 14.754 84.3074 14.754C85.5294 14.754 86.1274 15.612 86.2054 16.522C86.7514 15.3 88.2074 14.546 89.7414 14.546C92.7314 14.546 94.5514 16.548 94.5514 19.512V25.7C94.5514 26.922 93.7974 27.676 92.5754 27.676C91.3534 27.676 90.6254 26.922 90.6254 25.7V19.98C90.6254 18.81 89.7414 17.874 88.4674 17.874C87.2714 17.874 86.3094 18.732 86.3094 19.954V25.7C86.3094 26.922 85.5814 27.676 84.3594 27.676C83.1374 27.676 82.3834 26.922 82.3834 25.7ZM109.206 15.976C109.934 16.652 110.038 17.666 109.336 18.368C108.712 18.992 107.698 18.914 106.918 18.394C106.138 17.874 105.514 17.51 104.422 17.51C103.668 17.51 102.94 17.692 102.94 18.368C102.94 18.992 103.356 19.252 104.032 19.46L106.112 20.058C108.192 20.656 110.272 21.748 110.272 24.036C110.272 26.792 107.88 27.91 104.838 27.91C102.394 27.91 100.288 27.338 99.2484 25.986C98.5984 25.102 98.4944 24.088 99.2744 23.438C100.054 22.762 101.224 22.944 101.978 23.802C102.706 24.608 103.772 24.972 104.734 24.972C105.696 24.972 106.502 24.66 106.502 24.01C106.502 23.412 105.8 23.23 105.098 22.996L102.862 22.346C100.912 21.774 99.1704 20.656 99.1704 18.368C99.1704 15.612 101.796 14.546 104.552 14.546C106.762 14.546 108.27 15.144 109.206 15.976Z" fill="#00C7BE"/>
          </svg>
        </RouterLink>
      </div>
    </div>
    <ul id="menus">
      <li class="menu">
        <RouterLink to="/news">복지관소식</RouterLink>
      </li>
      <li class="menu">
        <RouterLink to="/recruit">구인구직</RouterLink>
      </li>
      <li class="menu">
        <RouterLink to="/career">커리어</RouterLink>
      </li>
    </ul>
    <div id="h-right">
      <RouterLink to="/login" v-if="isAnonymous">로그인</RouterLink>
      <div id="user-info-wrap" v-else>
        <button type="button" id="user-icon" ref="userButton" @click="showModal = !showModal">{{ user?.nickname }}</button>
        <div v-if="showModal" ref="modal" class="modal" @click="showModal = false">
          <RouterLink to="/user/info" class="modal-item">개인정보수정</RouterLink>
          <button type="button" @click="logout" class="modal-item logout">로그아웃</button>
        </div>
      </div>
    </div>
  </header>
</template>

<script setup lang="ts">
import { RouterLink } from 'vue-router';
import { useUserStore } from "@/stores/UserStore";
import { storeToRefs } from "pinia";
import {computed, onMounted, onUnmounted, ref} from "vue";
import { useRouter } from "vue-router";

const userStore = useUserStore();
const { isAnonymous, user } = storeToRefs(userStore);

const router = useRouter();

const showModal = ref(false);
const userButton = ref<HTMLElement | null>(null);
const modal = ref<HTMLElement | null>(null);
onMounted(async () => {
  document.addEventListener('click', handleClickOutside);
})
onUnmounted(() => {
  document.removeEventListener('click', handleClickOutside);
})

const handleClickOutside = (event: MouseEvent) => {
  // event.target이 Node인지 확인
  if (!event.target || !(event.target instanceof Node)) {
    return;
  }

  if (showModal.value &&
      userButton.value && !userButton.value.contains(event.target) &&
      (!modal.value || !modal.value.contains(event.target))) {
    showModal.value = false;
  }
}
const logout = async () => {
  await userStore.logout(
      (res: any) => {
        router.push("/login?logout");
      },
      (error: any) => {
        console.log('로그아웃 실패', error);
      }
  );
}
</script>
<style scoped>
header {
  height: 80px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
}

#menus {
  display: flex;
  gap: 16px;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  margin: 0;
  padding: 0;
  list-style: none;
}
#h-left {
  width: 120px;
}
#h-right {
  width: 120px;
  text-align: right;
}
.menu a {
  color: var(--f3);
  white-space: nowrap;
}
.menu a:hover, .menu a.router-link-active {
  color: var(--main-color-1);
  font-weight: 500;
}
.menu a.router-link-active {
  position: relative;
}
.menu a.router-link-active::after {
  content: '';
  position: absolute;
  height: 2px;
  width: 100%;
  border-radius: 2px;
  background: var(--main-color-gradient);
  top: 150%;
  left: 0;
  z-index: 2;
}


#user-icon {
  padding: 10px 15px;
  border-radius: 8px;
}
#user-icon:hover {
  background-color: #F5F5F5;
}

/* modal */
#user-info-wrap {
  position: relative;
}
.modal {
  position: absolute;
  z-index: 5;
  width: 100%;
  border-radius: 8px;
  border: 1px #E9ECEF solid;
  padding: 5px;
  display: flex;
  flex-direction: column;
  gap: 2px;
  top: 120%;
  background-color: white;
  box-shadow: 4px 4px 8px rgba(0,0,0,0.06);
}
.modal-item {
  height: 40px;
  border-radius: 8px;
  padding: 10px 12px;
  display: flex;
  justify-content: start;
  color: var(--f2);
  font-size: 14px;
}
.modal-item.logout {
  color: #FF4B4B;
}
.modal-item:hover {
  background-color: #f5f5f5;
}
.modal-item.logout:hover {
  background-color: rgba(255, 75, 75, 0.1);
}
</style>
